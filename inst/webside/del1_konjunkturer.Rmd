
```{r include=FALSE}
library(MakroOEKB1115)
library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)
library(latex2exp)

# Henter datasett
moltmacrousa <- MakroOEKB1115::moltmacrousa
unique(moltmacrousa$variable)

usadataI <- dplyr::filter(moltmacrousa, variable %in% c('unem', 'cunem', 'ggdp', 'inflation', 'cinflation', 'yinflation', 'cyinflation'))
fusadataI <- reshape2::dcast(usadataI, date + freqm ~ variable) %>% 
  dplyr::filter(freqm=='01', date >= '1948-01-01'& date < '2017-01-01')

okunusa <- qplot(data = fusadataI, x = ggdp, y = cunem, geom = c('point', 'smooth'), method='lm')
philipusa <- qplot(data = fusadataI, x = unem, y = yinflation, geom = c('point', 'smooth'), method='lm')

okunusag <- ggplot(data = fusadataI, aes(x = cunem, y = ggdp))  + geom_point() +  geom_smooth(method=lm, se=FALSE) + theme_classic() + labs(title = 'Okuns lov', subtitle = 'USA 1948-2016', x = 'Endring i arbeidsledigheten', y = c('Vekst i BNP (realpriser)'))

philipusag <- ggplot(data = fusadataI, aes(x = unem, y = cyinflation))  + geom_point() +  geom_smooth(method=lm, se=FALSE) + theme_classic() + labs(title = 'Phillips-kurven', subtitle = 'USA 1948-2016' ,x = 'Ledighetsrate', y = 'Endring i inflation')
```


```{r include=FALSE}
# Keyneskrysset
# Henter Jupyter data
keynesequ <- rjson::fromJSON(file=paste0(devtools::as.package(".")$path,'/inst/webside/jupyter/keynesequ.json'))

# Parameterverdier
exoparval <- list(c_1 = 0.6, oC = 25, oG= 50, a = 30, i = 0.03, oI = 50)
dexoparval <- list(c_1 = 0.6, oC = 25, oG= 50, a = 30, i = 0.03, oI = 110)

# Variabler som endrer seg
Yv <- c(0:600)

# Implikasoner
##
grad45v <- 0:rev(Yv)[1]
cdv <- eval(parse(text=keynesequ$CD),c(exoparval,list(Y=Yv)))
idv <- eval(parse(text=keynesequ$ID),c(exoparval,list(Y=Yv)))
gdv <- eval(parse(text=keynesequ$GD),c(exoparval,list(Y=Yv)))
#
dcdv <- eval(parse(text=keynesequ$CD),c(dexoparval,list(Y=Yv)))
didv <- eval(parse(text=keynesequ$ID),c(dexoparval,list(Y=Yv)))
dgdv <- eval(parse(text=keynesequ$GD),c(dexoparval,list(Y=Yv)))


## Likevekt
yeae <-eval(parse(text=keynesequ$AD),c(exoparval))
dyeae <-eval(parse(text=keynesequ$AD),c(dexoparval))

# Datatabell (format)
dfkeykryss <- data.frame(x = Yv, grad45 = grad45v, cd = cdv, id = idv, gd = gdv, idpgd = idv + gdv,
                         idpgdcd = idv + gdv + cdv, 
                         dcd = dcdv, did = didv, dgd = dgdv, didpgd = didv + dgdv,
                         didpgdcd = didv + dgdv + dcdv) %>% 
  reshape2::melt(id.vars = c("x")) %>% 
  dplyr::mutate(kat=substring(variable,6,6))

# Labeling
## Main
lablist <- list(x='inntekt, produksjon', y = 'AE (aggregert etterspørsel)')
## I plottet
lablistdf <- data.frame(label=c('ABC'),x=c(1),y=c(1))


# Ggplot2 (funksjon senere)
## Henter datasettet
datainp <- dplyr::filter(dfkeykryss, variable %in% c('grad45', 'id', 'idpgd', 'idpgdcd'))
## Komponent1
keykg <- ggplot(data = datainp, aes(x = x, y = value, color = factor(variable))) + 
  geom_line() +
  geom_point(aes(x=yeae, y=yeae)) +
  geom_segment(aes(x = yeae, y = 0, xend = yeae , yend = yeae), lty = 2) +
  geom_segment(aes(x = 0, y = yeae, xend = yeae , yend = yeae), lty = 2) + 
  geom_text(x=550, y=600, label = 'Y = AD', color = 'red') +
  geom_text(x=550, y=500, label = 'C+I+G', color = 'red') +
  geom_text(x=550, y=65, label = 'I', color = 'red') +
  geom_text(x=550, y=115, label = 'I+G', color = 'red') +
  scale_x_continuous(name=lablist$x, breaks = c(yeae), labels = c(TeX('$Y_{0}$'))) +
  scale_y_continuous(name=lablist$y, breaks = c(yeae), labels = c(TeX('$AE_{0}$'))) +
  labs(title= 'Keyneskrysset') + theme_classic() +
  theme(legend.position="none") +
  coord_cartesian() + 
  scale_colour_manual(values = c("black","black", "black", 'black'))

## Henter datasettet
ddatainp <- dplyr::filter(dfkeykryss, variable %in% c('grad45','idpgdcd','didpgdcd'))
## Komponent1
tl <- data.frame(x=c(100,0), y=c(100,0), label=c('abc', 'def'))

dkeykg <- ggplot(data = ddatainp, aes(x = x, y = value, color = factor(variable))) + 
  geom_line() +
  geom_point(aes(x=yeae, y=yeae)) +
  geom_segment(aes(x = dyeae, y = 0, xend = dyeae , yend = dyeae), lty = 2) +
  geom_segment(aes(x = 0, y = dyeae, xend = dyeae , yend = dyeae), lty = 2) + 
  geom_segment(aes(x = yeae, y = 0, xend = yeae , yend = yeae), lty = 2) +
  geom_segment(aes(x = 0, y = yeae, xend = yeae , yend = yeae), lty = 2) + 
  geom_text(x=560, y=600, label = 'Y = AD', color = 'red') +
  geom_text(x=560, y=550, label = "C+I'+G", color = 'red') +
  geom_text(x=560, y=475, label = "C+I+G", color = 'red') +
  #scale_x_continuous(name=lablist$x, breaks = c(dyeae), labels = c(TeX('$Y_{0}$'))) +
  #scale_y_continuous(name=lablist$y, breaks = c(dyeae), labels = c(TeX('$AE_{0}$'))) +
  scale_x_continuous(name=lablist$x, breaks = c(dyeae), labels = c(TeX('$Y_{1}$'))) +
  scale_y_continuous(name=lablist$y, breaks = c(dyeae), labels = c(TeX('$AE_{1}$'))) +
  labs(title= 'Keyneskrysset') + theme_classic() +
  theme(legend.position="none") +
  coord_cartesian() + 
  scale_colour_manual(values = c("black","black", "black", 'black'))
```

## Grunnleggende bakgrunnkunnskaper og enkel Keynes modell (lukket økonomi)

### Stabiliseringsmål lukket økonomi

Intern balanse (lukke produksjonsgapet):

$$(Y-\overline{Y})=0$$
  
---

### Sentrale nasjonalregnskapstall
- Bruttonasjonalprodukt (GDP/BNP): Den samlede verdien av alle varer og tjenester som blir produsert i landet i løpet av et år
    - Nominelt BNP (LY) 
$$LY = PY$$
    - Reelt BNP (Y)
$$Y = LY/P $$

- Bruttonasjonalinntekt (GNP/BNI): Den samlede verdien av alle varer og tjenester som landets innbyggere produserer i løpet av et år

---

- Arbeidsledighetsrate:

$$u = 1-\frac{L}{N}$$

- Inflasjon: 

$$\pi = \frac{\Delta P}{P} =\frac{P_{t} - P_{t-1}}{P_{t-1}}$$

---

### Noen sentrale empiriske sammenhenger

#### Okuns lov: negativ sammenheng mellom endring i arbeidsledighet og vekst (eller endring)  BNP (realpriser) 

```{r echo=FALSE}
okunusag 
```

---

#### Phillips-kurven: negativ sammenheng mellom arbeidsledighet og endring i inflasjon (eller inflasjon)

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Check for warnings
philipusag 
```

---

### Hva bestemmer aggregert BNP?
#### Kort sikt (0-3 år):
- Pga antagelsen om prisstivheter på kort sikt (uendret lønn og produktpriser), vil  samlet etterspørsel ($AE$) bestemme BNP ($Y$)
- Vi legger dette til grunn i enkel Keynes, IS-LM,  og Mundell-Fleming modellen (del I og del III)

#### Mellomlang sikt (5-10 år):
- Tilgangen på innsatsfaktorene arbeidskraft ($L$), teknologi ($A$) og kapital ($K$) bestemmer BNP ($Y$)
- Langsiktig likevektsbetingelse for AD-AS modellen (del I)

---

#### Lang sikt (10-50 år):
- Teknologisk framgang ($a$), kapitalakkumulasjon ($\Delta K$) og befolkningsvekst ($n$) bestemmer BNP ($Y$)
- Hovedresultatet fra Solow-modellen (del II)

---

### Enkel Keynes-modell 

- Likevekt i godemarkedet (varer og tjenester)

#### Aggregert etterspørsel (AE)
$$AE \equiv  C + I + G$$

#### Markeder i likevekt: Godemarkedet (varer og tjenester)
$$Y = AE$$

---

#### Husholdninger
$$C =  \overline{C} + c(Y - \overline{T})$$

Hvor $0<c<1$ og $\overline{C}>0$

#### Bedrifter
$$I = \overline{I} - b\cdot i$$

Hvor $\overline{I}>0$ og $b>1$ og 

#### Sentralbanken
$$i = \overline{i}$$

Hvor $\overline{i} >= 0$

---

#### Offentlige myndigheter
$$G = \overline{G}$$ og $$T = \overline{T}$$

---

#### Løsning av modellen:
Setter adferdsligningene inn i likevekstbetingelsen for godemarkedet

$$Y = \overline{C} + c(Y - \overline{T}) + \overline{I} - b\cdot i + \overline{G}$$

Løser modellen mhp. på Y (godemarkedet) 

$$Y = \frac{1}{1-c}  \left [ \overline{C} -c\cdot \overline{T} - T - b\cdot \overline{i} + \overline{G}  \right ]$$

Endogene variabler: $Y$ 

Eksogene variabler: $\overline{C}, \overline{T}, \overline{i}, \overline{I}, \overline{G}$

Parametre: $c, b$

---

-  Grafisk framvisning 

```{r echo=FALSE}
keykg
```

---

#### Komparativ statikk (analyse fra en likevekt til en annen): 

Økte investeringer ('animal spirits') $\Delta{\overline{I}}>0$

- **F**ormelt:
$$\Delta Y = \frac{1}{1-c}\Delta  \overline{I}>0 \text{ eller } \frac{\Delta Y}{\Delta  \overline{I} } = \frac{1}{1-c}>1$$

- **V**erbalt (tolkning utenfor modellen):

Økte investeringer $\rightarrow$ økt produksjon $\rightarrow$ initierer en multiplikatoreffekt: $\rightarrow$ økt disponibel inntekt $\rightarrow$ økt konsum $\rightarrow$ økt produksjon osv.

---

- **G**rafisk:

```{r echo=FALSE}
dkeykg
```

---

#### Stabiliseringspolitikk

Reduserte offentlige utgifter $\Delta G < 0$

$$\Delta Y = \frac{1}{1-c}  \left [ \Delta \overline{I} + \Delta \overline{G} \right ]$$

Dersom vi lar $\Delta \overline{I} = - \Delta \overline{G} > 0 \Rightarrow \Delta Y = 0$ (dvs. intern balanse)

- Merk: Det politiske systemet i de fleste land innebygd iboende tregheter tilknyttet budsjettendringer. Dette gjør finanspolitikk vanskelig å implementere som konjunkturstabiliserende virkemiddel, fordi treghetene gjør at man responderer for sent sett i forhold til konjunktursituasjonen

---

#### Øvelse

Redusert rentenivå $\Delta{\overline{i}}<0$

- **F**ormelt:

- **G**rafisk (Y, i plan):

- **V**erbalt (tolkning utenfor modellen):
