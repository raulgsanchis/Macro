---
output: html_notebook
# output:
#   html_document:
#     toc: true
#     toc_depth: 4
---

# Del 1: Konjunktursvingninger

```{r include=FALSE}
library(MakroOEKB1115)
library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)
library(latex2exp)

# Henter datasett
moltmacrousa <- MakroOEKB1115::moltmacrousa
unique(moltmacrousa$variable)

usadataI <- dplyr::filter(moltmacrousa, variable %in% c('unem', 'cunem', 'ggdp', 'inflation', 'cinflation', 'yinflation', 'cyinflation'))
fusadataI <- reshape2::dcast(usadataI, date + freqm ~ variable) %>% 
  dplyr::filter(freqm=='01', date >= '1948-01-01'& date < '2017-01-01')

okunusa <- qplot(data = fusadataI, x = ggdp, y = cunem, geom = c('point', 'smooth'), method='lm')
philipusa <- qplot(data = fusadataI, x = unem, y = yinflation, geom = c('point', 'smooth'), method='lm')

okunusag <- ggplot(data = fusadataI, aes(x = cunem, y = ggdp))  + geom_point() +  geom_smooth(method=lm, se=FALSE) + theme_classic() + labs(title = 'Okuns lov', subtitle = 'USA 1948-2016', x = 'Endring i arbeidsledigheten', y = c('Vekst i BNP (realpriser)'))

philipusag <- ggplot(data = fusadataI, aes(x = unem, y = cyinflation))  + geom_point() +  geom_smooth(method=lm, se=FALSE) + theme_classic() + labs(title = 'Phillips-kurven', subtitle = 'USA 1948-2016' ,x = 'Ledighetsrate', y = 'Endring i inflation')
```

```{r include=FALSE}
# Keyneskrysset
mlabels <- list(title= 'Keyneskrysset', x='produksjon, inntekt (Y)', y='Aggregert etterspørsel (AE)')
# Parameterverdier (Keyneskrysset)
Iv <- 0:600
exoparval <- c(list(c_1 = 0.6, oC = 25, oG= 50, a = 30, i = 0.03, oI = 50, T = 10), list(Y=c(Iv)))
cexoparval <- c(list(c_1 = 0.6, oC = 25, oG= 50, a = 30, i = 0.03, oI = 90, T = 10), list(Y=c(Yv)))
dfkeynes <- dfgpmakro(Iv, exoparval, endr=0)
cdfkeynes <- dfgpmakro(Yv, cexoparval, endr=1)
eqsol <- list(x= c(dfkeynes$yeae), y = c(dfkeynes$yeae))
ceqsol <- list(x= c(dfkeynes$yeae, cdfkeynes$yeae), y = c(dfkeynes$yeae, cdfkeynes$yeae))
eqlinjey <- list(breaksvy = eqsol$y, labels = c(TeX('$AE_{0}$')))
eqlinjex <- list(breaksvx = eqsol$x, labels = c(TeX('$Y_{0}$')))
unique(dfkeynes$dfmodell$variable)

rev(subset(dfkeynes$dfmodell, variable == 'gdv')$value)[1]
rev(subset(dfkeynes$dfmodell, variable == 'gdvpidv')$value)[1]
rev(subset(dfkeynes$dfmodell, variable == 'cdvpidvgdv')$value)[1]
rev(subset(dfkeynes$dfmodell, variable == 'grad45v')$value)[1]
labldf <- data.frame(labeling=c("45 grader", "I", "C + I", "C + I + G", "Y = AE"), 
                     x = c(105, 560, 560, 560, 560), 
                     y = c(20, 50+10, 100+10, 480+10, 600+10),
                     col = c('black', rep(c('red'),1,4)))

keynesc <- makrofigure(ndata = dfkeynes$dfmodell,
                            labt = mlabels,
                            variables = c('grad45v', 'gdv', 'gdvpidv','cdvpidvgdv'),
                            labplassmon = labldf,
                            equisol = eqsol,
                            scalebreaksx = eqlinjex,
                            scalebreaksy = eqlinjey,
                            colorl = c(rep('black',4)))

###
rev(subset(dfkeynes$dfmodell, variable == 'cdvpidvgdv')$value)[1]
ceqlinjey <- list(breaksvy = ceqsol$y, labels = c(TeX('$AE_{0}$'), TeX('$AE_{1}$')))
ceqlinjex <- list(breaksvx = ceqsol$x, labels = c(TeX('$Y_{0}$'), TeX('$Y_{0}$')))
rev(subset(cdfkeynes$dfmodell, variable == 'cdvpidvgdv')$value)[1]
rev(subset(cdfkeynes$dfmodell, variable == 'grad45v')$value)[1]
labldf <- data.frame(labeling=c("45 grader", "C + I + G", "C+ I' + G", "Y=AE"), 
                     x = c(105, 560, 560, 560), 
                     y = c(20, 480+5, 520+5, 600+5),
                     col = c('black', rep(c('red'),1,3)))

keynesccinv <- makrofigurechange(ndata = dfkeynes$dfmodell,
                            labt = mlabels,
                            variables = c('grad45v','cdvpidvgdv'),
                            labplassmon = labldf,
                            equisol = ceqsol,
                            scalebreaksx = ceqlinjex,
                            scalebreaksy = ceqlinjey,
                            colorl = c(rep('black',3)),
                            odata = cdfkeynes$dfmodell,
                            ovariables = c('cdvpidvgdv'))
```

## Grunnleggende bakgrunnkunnskaper 

### Stabiliseringsmål lukket økonomi

Intern balanse (lukke produksjonsgapet):

$$(Y-\overline{Y})=0$$
  
---

### Sentrale nasjonalregnskapstall
- Bruttonasjonalprodukt (GDP/BNP): Den samlede verdien av alle varer og tjenester som blir *produsert i landet* i løpet av et år
    - Nominelt BNP (LY) 
$$LY = PY$$
    - Reelt BNP (Y)
$$Y = LY/P $$

- Bruttonasjonalinntekt (GNP/BNI): Den samlede verdien av alle varer og tjenester som *landets innbyggere produserer* i løpet av et år

---

- Arbeidsledighetsrate:

$$u = 1-\frac{L}{N}$$

- Inflasjon: 

$$\pi = \frac{\Delta P}{P} =\frac{P_{t} - P_{t-1}}{P_{t-1}}$$

---

### Noen sentrale empiriske sammenhenger

#### Okuns lov: negativ sammenheng mellom endring i arbeidsledighet og vekst (eller endring i vekst)  i BNP (realpriser) 

```{r echo=FALSE}
okunusag 
```

---

#### Phillips-kurven: negativ sammenheng mellom arbeidsledighet og endring i inflasjon (eller inflasjon)

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Check for warnings
philipusag 
```

---

### Hva bestemmer aggregert produksjon (BNP)?
#### Kort sikt (0-3 år):
- Pga antagelsen om prisstivheter på kort sikt (uendret lønn og produktpriser), vil  samlet etterspørsel ($AE$) bestemme BNP ($Y$)
- Vi legger dette til grunn i enkel Keynes, IS-LM,  og Mundell-Fleming modellen (del I og del III)

#### Mellomlang sikt (5-10 år):
- Tilgangen på innsatsfaktorene arbeidskraft ($L$), teknologi ($A$) og kapital ($K$) bestemmer BNP ($Y$)
- Langsiktig likevektsbetingelse for AD-AS modellen (del I)

---

#### Lang sikt (10-50 år):
- Teknologisk framgang ($a$), kapitalakkumulasjon ($\Delta K$) og befolkningsvekst ($n$) bestemmer BNP ($Y$)
- Hovedresultatet fra Solow-modellen (del II)

---

## Enkel Keynes-modell 

- Likevekt i godemarkedet (varer og tjenester)

### Aggregert etterspørsel (AE)
(@AE) $$AE \equiv  C + I + G$$

### Markeder i likevekt: Godemarkedet (varer og tjenester)
(@MG) $$Y = AE \equiv  C + I + G$$

---

### Adferdsligninger

#### Husholdninger

(@CH) $$C =  \overline{C} + c(Y - T)$$

Hvor $0<c<1$ og $\overline{C}>0$

#### Bedrifter
(@ID) $$I = \overline{I} - b\cdot i$$

Hvor $\overline{I}>0$ og $b>1$ og 

#### Sentralbanken
(@CB) $$i = \overline{i}$$

Hvor $\overline{i} >= 0$

---

#### Offentlige myndigheter

(@OMG) $$G = \overline{G}$$ 

og

(@OMT) $$T = \overline{T}$$ 


---

### Løsning av modellen:
Setter adferdsligningene (@CH) - (@OM) inn i likevekstbetingelsen for godemarkedet (@MG)

$$Y = \overline{C} + c(Y - \overline{T}) + \overline{I} - b\cdot \overline{i} + \overline{G}$$

Løser modellen mhp. på Y (godemarkedet) 

(@LBL) $$Y = \frac{1}{1-c}  \left [ \overline{C} -c\cdot \overline{T} - b\cdot \overline{i} + \overline{G}  \right ]$$

Endogene variabler (bestemt av modellen): $Y, C, I, G$ 

Eksogene variabler (bestemt utenfor modellen): $\overline{C}, \overline{T}, \overline{i}, \overline{I}, \overline{G}$

Parametre: $c, b$

---

-  Grafisk framvisning 

```{r echo=FALSE}
keynesc
```

---

### Komparativ statikk (analyse fra en likevekt til en annen): 

Økte investeringer ('animal spirits') $\Delta{\overline{I}}>0$

- **F**ormelt:
(@KSI) $$\Delta Y = \frac{1}{1-c}\Delta  \overline{I}>0 \text{ eller } \frac{\Delta Y}{\Delta  \overline{I} } = \frac{1}{1-c}>1$$

- **V**erbalt (dynamisk tolkning utenfor modellen):

Økte investeringer $\rightarrow$ økt produksjon $\rightarrow$ initierer en multiplikatoreffekt: $\rightarrow$ økt disponibel inntekt $\rightarrow$ økt konsum $\rightarrow$ økt produksjon osv.

---

- **G**rafisk:

```{r echo=FALSE}
keynesccinv
```

---

### Stabiliseringspolitikk

Reduserte offentlige utgifter $\Delta G < 0$

(@KSISG) $$\Delta Y = \frac{1}{1-c}  \left [ \Delta \overline{I} + \Delta \overline{G} \right ]$$

Dersom vi lar $\Delta \overline{I} = - \Delta \overline{G} > 0 \Rightarrow \Delta Y = 0$ (dvs. intern balanse)

- Merk: Det politiske systemet i de fleste land innebygd iboende tregheter tilknyttet budsjettendringer. Dette gjør finanspolitikk vanskelig å implementere som konjunkturstabiliserende virkemiddel, fordi treghetene gjør at man responderer for sent sett i forhold til konjunktursituasjonen

---

### Øvelse

Redusert rentenivå $\Delta{\overline{i}}<0$

- **F**ormelt:

- **G**rafisk (Y, i plan):

- **V**erbalt (tolkning utenfor modellen):

---

## IS-LM modellen

```{r include=FALSE}
iv <- 0:7.5
exoparvalv <- c(list(c_1 = 0.6, oC = 25, oG= 75, b = 15, oI = 75, T = 10, M= 200, P=1, h = 80, k =2, Y = 300), list(i=c(iv)))
cexoparvalv <- c(list(c_1 = 0.6, oC = 25, oG= 75, b = 15, oI = 75, T = 10, M= 250, P=1, h = 80, k =2, Y = 300), list(i=c(iv)))
dfislm <- dfgpmakro2(Iv=iv, exoparval = exoparvalv, endr=0)
cdfislm <- dfgpmakro2(Iv=iv, exoparval = cexoparvalv, endr=0)

# Pengemarkedet
mlabels <- list(title= 'Pengemarkedet', y='Pengetilbudet (M/P)', x='rentenivå (i)')
labldf <- labldf <- data.frame(labeling=c("Ms", "Ld"), 
                     x = c(7.5, 1), 
                     y = c(200+30, 600),
                     col = c(rep(c('red'),1,2)))
eqsol <- list(x= c(5), y = c(200))
eqlinjey <- list(breaksvy = eqsol$y, labels = c(TeX('$M_{0}/P_{0}$')))
eqlinjex <- list(breaksvx = eqsol$x, labels = c(TeX('$i_{0}$')))

figpengem <- makrofigure(ndata = dfislm$dfmodell,
                            variables = c("ldv", "msv"),
                            labt = mlabels,
                            labplassmon = labldf,
                            equisol = eqsol,
                            scalebreaksx = eqlinjex,
                            scalebreaksy = eqlinjey,
                            colorl = c(rep('black',2))) + coord_flip()

# Penge- og godemarkedet 
# figpengem <- makrofigure(ndata = cdfislm$dfmodell,
#                             variables = c("ldv", "msv"),
#                             labt = mlabels,
#                             labplassmon = labldf,
#                             equisol = eqsol,
#                             scalebreaksx = eqlinjex,
#                             scalebreaksy = eqlinjey,
#                             colorl = c(rep('black',2))) + coord_flip()



islmlabels <- list(title= 'IS-LM modellen', x='rentenivå (i)', y='Produksjon, inntekt (Y)')

## Labeling
lableg <- list(title= 'IS-LM modellen', x='Y', y='i')
eqsol <- list(x= c(4.2), y = c(268))
rev(subset(dfislm$dfmodell, variable == 'isv')$value)[1]
rev(subset(dfislm$dfmodell, variable == 'lmv')$value)[1]
labldfislm <- labldf <- data.frame(labeling=c("IS-kurven", "LM-kurven"), 
                     x = c(7, 2), 
                     y = c(160+40, 380+20),
                     col = c(rep(c('red'),1,2)))

eqlinjey <- list(breaksvy = eqsol$y, labels = c(TeX('$Y_{0}$')))
eqlinjex <- list(breaksvx = eqsol$x, labels = c(TeX('$i_{0}$')))

figislm <- makrofigure(ndata = dfislm$dfmodell, 
                          variables = c("isv", "lmv"),
                          labt = islmlabels,
                          labplassmon = labldfislm,
                          equisol = eqsol,
                          scalebreaksx = eqlinjex,
                          scalebreaksy = eqlinjey,
                          color = rep(c('black'),2)) + coord_flip()

```


### Markeder i likevekt: Gode- og pengemarkedet
(@mgo) $$Y = AE$$ 

(@mpe) $$L_{m} = M/P$$

### Adferdsligninger

#### Husholdninger
Bestemmer pengeetterspørselen (realverdi)
(@mpe) $$L_{m} = kY -hi$$
Hvor $k>0$ og $h>0$

#### Sentralbanken
$$M = \overline{M} $$

#### Offentlige myndighter

$$T = tY $$
Hvor $t$ er prosentvis skattesats

### Løsning av modellen:
#### Godemarkedet (samme løsningsmetodikk som under enkel Keynes-modell)
$$Y = \frac{1}{1-c}  \left [ \overline{C} -c\cdot \overline{T} - b\cdot \overline{i} + \overline{G}  \right ]$$

#### Pengemarkedet
Bestemmer pengetilbudet
$$kY -hi = \overline{M}/P$$

```{r echo=FALSE}
figpengem
```


### IS-LM diagrammet (gode- og pengemarkedet i likevekt samtidig)
**Formelt**

IS-kurven finner vi ved å differensiere likevektsbetingelsen for godemarkedet mph. Y og i:

$$\Delta Y = (\frac{-b}{1-c})\cdot \Delta \overline{i}<0$$

LM-kurven finner vi ved å differensiere likevektsbetingelsen for pengemarkedet mhp. Y og i:

$$k\Delta Y -h\Delta i = 0 \Leftrightarrow  \frac{\Delta Y}{\Delta i} = \frac{h}{k} > 0 $$
**Grafisk**
```{r echo=FALSE}
figislm
```

### Komparativ statikk: 

Økning i pengemengden (M)

- **G**rafisk


```{r echo=FALSE}
grid.arrange(figpengem, figislm , ncol= 2)
```


- **V**erbalt (dynamisk tolkning utenfor modellen)

### Stabiliseringspolitikk

#### Øvelse

Reduksjon i prisnivået (P)

- **G**rafisk (Y, i plan) og (P, Y plan) 

- **V**erbalt (tolkning utenfor modellen):

<!--

## AS-kurven

### Arbeidsmarkedet  

### ledighet 

### AS-kurven

## Bakgrunnskunnskap om åpen Økonomi

### Stabiliseringsmål for en åpen økonomi
1. Intern balanse (lukke produksjonsgapet)
1. Ekstern balanse (holde utenlandsgjelden på et rimelig nivå)

### Utenriksregnskapet

## Mundell-Fleming modellen (IS-LM for en åpen økonomi)

### Markeder i likevekt: Gode-, penge- og valutakursmarkedet

### Adferdslikninger

#### Husholdninger

#### Bedrifter

#### Sentralbanken

#### Offentlige myndigheter

### Løsning av modellen fast kurs

### Komparativ statikk

### Stabiliseringspolitikk

### Løsning av modellen flytende kurs

### Komparativ statikk

### Stabiliseringspolitikk

### Øvelse

## AD-AS for en åpen økonomi

### Markeder i likevekt: Gode-, penge-, or arbeids- og valutakursmarkedet

### Adferdslikninger

#### Husholdninger

#### Bedrifter

#### Sentralbanken

#### Offentlige myndigheter

### Løsning av modellen fast kurs

### Komparativ statikk

### Stabiliseringspolitikk

### Løsning av modellen flytende kurs

### Komparativ statikk

### Stabiliseringspolitikk

-->
